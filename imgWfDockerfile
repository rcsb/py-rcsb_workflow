FROM node:20

# needs to be in a project dir for node to install correctly
RUN mkdir -p /opt/modules
WORKDIR /opt/modules

RUN apt update -y && apt upgrade -y

RUN npm i molstar
RUN npm i molrender
RUN apt -yqq install libgl1-mesa-dev xvfb

# setup pip and make venv otherwise "This environment is externally managed "
RUN apt install python3-pip -y
RUN apt install python3.11-venv -y
RUN python3 -m venv .venv
ENV PATH="/opt/modules/.venv/bin:$PATH"

# weird openeye issue solution
RUN pip install --upgrade pip
RUN pip install python-novaclient
RUN pip install --extra-index-url https://pypi.anaconda.org/OpenEye/simple OpenEye-toolkits

WORKDIR /app
COPY . /app
RUN pip install .
WORKDIR /opt/modules
